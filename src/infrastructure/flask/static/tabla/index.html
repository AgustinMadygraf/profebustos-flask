<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Tabla de Conversiones</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h2 class="mb-4">Conversiones registradas</h2>
    <table class="table table-bordered table-striped" id="conversiones-table">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Tipo</th>
                <th>Timestamp</th>
                <th>Sección</th>
                <th>Web</th>
            </tr>
        </thead>
        <tbody>
            <!-- Los datos se insertarán aquí -->
        </tbody>
    </table>
    <div id="error-message" class="alert alert-danger d-none"></div>
</div>
<script>
    // Convierte UTC a hora local de Buenos Aires y lo muestra como "día/mes/año hh:mm:ss am/pm"
    function mostrarHoraLocal(utcString) {
        const fecha = new Date(utcString);
        return fecha.toLocaleString('es-AR', {
            timeZone: 'America/Argentina/Buenos_Aires',
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: true
        });
    }

    fetch('/conversiones')
        .then(response => response.json())
        .then(data => {
            const tbody = document.querySelector('#conversiones-table tbody');
            if (Array.isArray(data)) {
                data.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${row.id}</td>
                        <td>${row.tipo}</td>
                        <td>${mostrarHoraLocal(row.timestamp)}</td>
                        <td>${row.seccion}</td>
                        <td>${row.web || ''}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } else {
                document.getElementById('error-message').textContent = data.error || 'Error al cargar conversiones';
                document.getElementById('error-message').classList.remove('d-none');
            }
        })
        .catch(err => {
            document.getElementById('error-message').textContent = 'Error de red al cargar conversiones';
            document.getElementById('error-message').classList.remove('d-none');
        });
</script>
</body>
</html>